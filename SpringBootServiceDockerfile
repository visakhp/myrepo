# Use latest ubuntu image as the base
FROM ubuntu:17.10

RUN useradd -m visakh ; echo visakh: | chpasswd ; usermod -a -G root visakh

ENV TOPDIR /springbootservices

COPY jdk*.gz /tmp

RUN mkdir /usr/lib/jvm
RUN mkdir $TOPDIR
RUN mkdir $TOPDIR/log

WORKDIR /tmp
RUN tar -zxf /tmp/jdk*.gz -C /usr/lib/jvm
RUN chmod -R 777 /usr/lib/jvm
RUN chown -R visakh:root /usr/lib/jvm
COPY springboot_service_environment.properties $TOPDIR

RUN update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk*/bin/java 100
RUN update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk*/bin/javac 100

RUN chmod 777 /usr/bin/java
RUN chmod 777 /usr/bin/javac

RUN apt-get update && \
      apt-get -y install unzip zip vim

RUN apt-get update && apt-get install -y iputils-ping

RUN chmod -R 777 $TOPDIR
RUN chown -R visakh:root $TOPDIR
COPY springbooteurekaserver.jar "$TOPDIR"

WORKDIR $TOPDIR

ENV JAVA_HOME="/usr/lib/jvm/jdk1.8.0_152"

# RUN java -version

RUN rm -f /tmp/jdk*.gz

ENV JAVA_OPTS="-Xms1024m -Xmx1024m -XX:MaxPermSize=256m -XX:+UseConcMarkSweepGC -XX:+CMSPermGenSweepingEnabled \
-XX:+CMSClassUnloadingEnabled -Djava.net.preferIPv4Stack=true \
-Dspring.config.location=classpath:/org/springboot/micro/services/server/springboot_application.properties,\
file:/springbootservices/springboot_service_environment.properties"

# Expose the ports we're interested in
EXPOSE 8180

# Set the default command to run on boot
# This will boot JBoss EAP in the standalone mode and bind to all interface
CMD java $JAVA_OPTS -jar $TOPDIR/springbooteurekaserver.jar

